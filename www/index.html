<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    
    <title>äºˆå®šè¡¨</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="offline-indicator" id="offlineIndicator">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³</div>
    <div class="connection-status connecting" id="connectionStatus">æ¥ç¶šä¸­...</div>
    <div class="sync-status syncing" id="syncStatus">åŒæœŸä¸­</div>
    <div class="loading-indicator" id="loadingIndicator">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</div>
    <div class="read-counter" id="readCounter">ğŸ“Š èª­ã¿å–ã‚Š: 0å›</div>
    
    <div class="app">
        <header class="header">
            <div class="nav">
                <div class="week-controls-wrapper">
                    <div class="week-controls">
                        <button class="week-btn" id="prevWeekBtn" onclick="changeWeek(-1)">â€¹</button>
                        <span class="week-display" id="weekDisplay" onclick="openCalendarModal()"></span>
                        <button class="week-btn" id="nextWeekBtn" onclick="changeWeek(1)">â€º</button>
                    </div>
                    <span class="cache-status-below" id="cacheStatus">ã‚­ãƒ£ãƒƒã‚·ãƒ¥: 0é€±</span>
                </div>
                <button class="btn" onclick="goToToday()">ä»Šæ—¥</button>
                <button class="btn" id="bulkMenuBtn" onclick="toggleBulkMenu()">ä¸€æ‹¬</button>
                <button class="btn" onclick="openSearchModal()">æ¤œç´¢</button>
                
                <!-- ä¸€æ‹¬ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆåˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤ºï¼‰ -->
                <div id="bulkMenuButtons" style="display:none;">
                    <button class="btn" id="bulkReservationBtn" onclick="toggleBulkReservationMode()">ä¸€æ‹¬äºˆç´„</button>
                    <button class="btn primary" id="bulkProceedBtn" onclick="proceedToBulkReservation()" style="display:none">äºˆç´„ã¸é€²ã‚€ (<span id="bulkSelectionCount">0</span>ä»¶)</button>
                    <button class="btn" id="bulkDeleteBtn" onclick="toggleBulkDeleteMode()">ä¸€æ‹¬å‰Šé™¤</button>
                    <button class="btn danger" id="bulkDeleteExecuteBtn" onclick="executeBulkDelete()" style="display:none">å‰Šé™¤ã™ã‚‹ (<span id="bulkDeleteCount">0</span>ä»¶)</button>
                </div>
            </div>
            <div class="nav">
                <button class="btn" onclick="openManagement()">ç®¡ç†</button>
            </div>
            <div class="mobile-nav">
                <div class="mobile-buttons">
                    <div class="mobile-left">
                        <button class="week-btn" id="prevWeekBtnMobile" onclick="changeWeek(-1)">â€¹</button>
                        <span class="week-display" id="weekDisplayMobile" onclick="openCalendarModal()"></span>
                        <button class="week-btn" onclick="changeWeek(1)">â€º</button>
                    </div>
                    <div class="mobile-right">
                        <button class="btn" onclick="goToToday()">ä»Šæ—¥</button>
                        <button class="btn" id="bulkMenuBtnMobile" onclick="toggleBulkMenu()">ä¸€æ‹¬</button>
                        <button class="btn" onclick="openSearchModal()">æ¤œç´¢</button>
                        <span class="cache-status" id="cacheStatusMobile">ã‚­ãƒ£ãƒƒã‚·ãƒ¥: 0é€±</span>
                    </div>
                </div>
                <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ä¸€æ‹¬ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
                <div id="bulkMenuButtonsMobile" style="display:none;margin-top:8px;">
                    <button class="btn" id="bulkReservationBtnMobile" onclick="toggleBulkReservationMode()">ä¸€æ‹¬äºˆç´„</button>
                    <button class="btn primary" id="bulkProceedBtnMobile" onclick="proceedToBulkReservation()" style="display:none">äºˆç´„ã¸é€²ã‚€ (<span id="bulkSelectionCountMobile">0</span>ä»¶)</button>
                    <button class="btn" id="bulkDeleteBtnMobile" onclick="toggleBulkDeleteMode()">ä¸€æ‹¬å‰Šé™¤</button>
                    <button class="btn danger" id="bulkDeleteExecuteBtnMobile" onclick="executeBulkDelete()" style="display:none">å‰Šé™¤ã™ã‚‹ (<span id="bulkDeleteCountMobile">0</span>ä»¶)</button>
                </div>
            </div>
        </header>
        <main class="main">
            <div class="table-container" id="tableContainer">
                <table class="table" id="mainTable">
                    <tbody>
                        <tr>
                            <td class="loading-table" colspan="100%">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>

    </div>

    <!-- æ¤œç´¢ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="searchModal" class="modal">
        <div class="modal-content" style="max-width:600px">
            <span class="close" onclick="closeSearchModal()">&times;</span>
            <h2 class="modal-header">äºˆå®šæ¤œç´¢</h2>
            
            <div class="form-section">
                <label class="form-label">åå‰ã§æ¤œç´¢:</label>
                <input type="text" id="searchNameInput" class="input" placeholder="å§“ã¾ãŸã¯åã‚’å…¥åŠ›" 
                       style="width:100%;padding:12px;font-size:16px;border-radius:8px;border:1px solid #ddd"
                       onkeyup="if(event.key==='Enter') searchByName()">
                <button class="action-btn primary" onclick="searchByName()" style="margin-top:10px;width:100%">ğŸ” æ¤œç´¢</button>
            </div>
            
            <div id="searchResults" style="display:none;margin-top:20px">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                    <h3 style="margin:0;font-size:16px">æ¤œç´¢çµæœ: <span id="searchResultCount">0</span>ä»¶</h3>
                    <button class="action-btn secondary" onclick="clearSearchResults()" style="padding:6px 12px;font-size:13px">ã‚¯ãƒªã‚¢</button>
                </div>
                <div id="searchResultList" style="max-height:400px;overflow-y:auto;background:#f9f9f9;border-radius:8px;padding:10px"></div>
            </div>
            
            <div class="modal-actions" style="margin-top:20px">
                <button class="action-btn secondary" onclick="closeSearchModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="calendarModal" class="modal calendar-modal">
        <div class="modal-content calendar-content">
            <div class="calendar-header">
                <button class="calendar-nav" onclick="changeCalendarMonth(-1)">â€¹</button>
                <span id="calendarTitle"></span>
                <button class="calendar-nav" onclick="changeCalendarMonth(1)">â€º</button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
            <div class="modal-actions">
                <button class="action-btn secondary" onclick="closeCalendarModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="managementModal" class="modal">
        <div class="modal-content" style="max-width:700px">
            <span class="close" onclick="closeManagement()">&times;</span>
            <h2 class="modal-header">ç®¡ç†ç”»é¢</h2>
            
            <div class="form-section">
                <label class="form-label">ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨çŠ¶æ³:</label>
                <div style="background:#f5f5f5;border-radius:8px;padding:15px;margin-bottom:20px">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                        <div>
                            <div style="font-size:14px;color:#666;margin-bottom:5px">ä»Šæ—¥ã®èª­ã¿å–ã‚Š</div>
                            <div style="font-size:18px;font-weight:bold;margin-bottom:3px" id="managementReadCount">0å› (ã“ã®ç«¯æœ«)</div>
                            <div style="font-size:22px;font-weight:bold;color:#2196f3" id="managementTotalCount">0å›</div>
                            <div style="font-size:12px;color:#666">å…¨ç«¯æœ«åˆè¨ˆ</div>
                        </div>
                        <div style="text-align:right">
                            <div style="font-size:12px;color:#666">ç„¡æ–™æ : 50,000å›/æ—¥</div>
                            <div style="font-size:14px;font-weight:bold" id="managementRemaining">æ®‹ã‚Š: 50,000å›</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:8px">
                        <button class="action-btn primary" onclick="refreshTotalCount()" style="flex:1">ğŸ”„ æœ€æ–°ã®åˆè¨ˆã‚’å–å¾—</button>
                        <button class="action-btn primary" onclick="openFirebaseConsole()" style="flex:1">Firebase Consoleã§ç¢ºèª</button>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <label class="form-label">ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›:</label>
                <div style="display:flex;gap:10px;justify-content:center;margin-bottom:20px">
                    <button class="action-btn primary" onclick="exportPDF()">PDFå‡ºåŠ›</button>
                    <button class="action-btn primary" onclick="exportExcel()">Excelå‡ºåŠ›</button>
                </div>
            </div>
            
            <div class="form-section">
                <label class="form-label">ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†:</label>
                <div id="staffList" class="list"></div>
            </div>
            
            <div class="form-section">
                <label class="form-label">æ–°ã—ã„ã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ :</label>
                <div style="display:flex;gap:10px">
                    <input type="text" id="newStaffSurname" class="form-input" placeholder="å§“" style="flex:1" lang="ja" inputmode="text" autocomplete="off">
                    <input type="text" id="newStaffFirstname" class="form-input" placeholder="å" style="flex:1" lang="ja" inputmode="text" autocomplete="off">
                    <button class="action-btn primary" onclick="addStaff()">è¿½åŠ </button>
                </div>
            </div>
            
            <!-- â­ æœ‰çµ¦ãƒ»å…¬ä¼‘æ—¥ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="form-section">
                <label class="form-label">æœ‰çµ¦ãƒ»å…¬ä¼‘æ—¥ç®¡ç†:</label>
                <div id="staffLeaveList" class="list"></div>
            </div>
            
            <div class="form-section">
                <label class="form-label">æœ‰çµ¦ãƒ»å…¬ä¼‘æ—¥ã®è¿½åŠ :</label>
                <div style="display:flex;flex-direction:column;gap:12px">
                    <div style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:100px;font-weight:600;font-size:14px">ã‚¹ã‚¿ãƒƒãƒ•:</label>
                        <select id="leaveStaffSelect" class="form-select" style="flex:1">
                            <option value="">ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠ</option>
                        </select>
                    </div>
                    <div style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:100px;font-weight:600;font-size:14px">æ—¥ä»˜:</label>
                        <input type="date" id="leaveDate" class="form-input" style="flex:1">
                    </div>
                    <div style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:100px;font-weight:600;font-size:14px">é–‹å§‹æ™‚é–“:</label>
                        <select id="leaveStartTime" class="form-select" style="flex:1">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        </select>
                    </div>
                    <div style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:100px;font-weight:600;font-size:14px">çµ‚äº†æ™‚é–“:</label>
                        <select id="leaveEndTime" class="form-select" style="flex:1">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        </select>
                    </div>
                    <div style="display:flex;justify-content:flex-end">
                        <button class="action-btn primary" onclick="addStaffLeave()">è¿½åŠ </button>
                    </div>
                </div>
            </div>
            
            <!-- â­ ã‚¹ã‚¿ãƒƒãƒ•å…¥ã‚Œæ›¿ãˆç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="form-section">
                <label class="form-label">ã‚¹ã‚¿ãƒƒãƒ•å…¥ã‚Œæ›¿ãˆç®¡ç†:</label>
                <div id="staffOverrideList" class="list"></div>
            </div>
            
            <div class="form-section">
                <label class="form-label">æ–°ã—ã„ã‚¹ã‚¿ãƒƒãƒ•å…¥ã‚Œæ›¿ãˆã‚’è¿½åŠ :</label>
                <div style="display:flex;flex-direction:column;gap:12px">
                    <div style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:100px;font-weight:600;font-size:14px">æ—¥ä»˜:</label>
                        <input type="date" id="overrideDate" class="form-input" style="flex:1">
                    </div>
                    <div style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:100px;font-weight:600;font-size:14px">ä¼‘ã¿ã«ã™ã‚‹:</label>
                        <select id="overrideOriginalStaff" class="form-select" style="flex:1">
                            <option value="">ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠ</option>
                        </select>
                    </div>
                    <div style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:100px;font-weight:600;font-size:14px">ä»£ã‚ã‚Šã«å‡ºå‹¤:</label>
                        <select id="overrideReplacementStaff" class="form-select" style="flex:1">
                            <option value="">ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠ</option>
                        </select>
                    </div>
                    <div style="display:flex;justify-content:flex-end">
                        <button class="action-btn primary" onclick="addStaffOverride()">è¿½åŠ </button>
                    </div>
                </div>
            </div>
            
            <!-- ãƒ‡ã‚¤ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="form-section">
                <label class="form-label">ãƒ‡ã‚¤ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†:</label>
                <div id="dayScheduleList" class="list"></div>
            </div>
            
            <div class="form-section">
                <label class="form-label">æ–°ã—ã„ãƒ‡ã‚¤è¨­å®šã‚’è¿½åŠ :</label>
                <div style="display:flex;flex-direction:column;gap:12px">
                    <div style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:80px;font-weight:600;font-size:14px">ã‚¹ã‚¿ãƒƒãƒ•:</label>
                        <select id="dayScheduleStaffSelect" class="form-select" style="flex:1">
                            <option value="">ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠ</option>
                        </select>
                    </div>
                    <div style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:80px;font-weight:600;font-size:14px">æ›œæ—¥:</label>
                        <div id="dayScheduleDaysSection" style="display:flex;gap:8px;flex-wrap:wrap">
                            <label class="workday-checkbox">
                                <input type="checkbox" value="1">
                                <span class="checkmark"></span>
                                <span class="day-label">æœˆ</span>
                            </label>
                            <label class="workday-checkbox">
                                <input type="checkbox" value="2">
                                <span class="checkmark"></span>
                                <span class="day-label">ç«</span>
                            </label>
                            <label class="workday-checkbox">
                                <input type="checkbox" value="3">
                                <span class="checkmark"></span>
                                <span class="day-label">æ°´</span>
                            </label>
                            <label class="workday-checkbox">
                                <input type="checkbox" value="4">
                                <span class="checkmark"></span>
                                <span class="day-label">æœ¨</span>
                            </label>
                            <label class="workday-checkbox">
                                <input type="checkbox" value="5">
                                <span class="checkmark"></span>
                                <span class="day-label">é‡‘</span>
                            </label>
                            <label class="workday-checkbox">
                                <input type="checkbox" value="6">
                                <span class="checkmark"></span>
                                <span class="day-label">åœŸ</span>
                            </label>
                        </div>
                    </div>
                    <div style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:80px;font-weight:600;font-size:14px">ãƒ‘ã‚¿ãƒ¼ãƒ³:</label>
                        <select id="daySchedulePattern" class="form-select" style="flex:1">
                            <option value="custom">ã‚«ã‚¹ã‚¿ãƒ ï¼ˆæ™‚é–“æŒ‡å®šï¼‰</option>
                            <option value="pattern1">ãƒ‘ã‚¿ãƒ¼ãƒ³â‘  9:20-14:40</option>
                            <option value="pattern2">ãƒ‘ã‚¿ãƒ¼ãƒ³â‘¡ 13:00-14:40</option>
                        </select>
                    </div>
                    <div id="customTimeSection" style="display:flex;gap:10px;align-items:center">
                        <label style="min-width:80px;font-weight:600;font-size:14px">æ™‚é–“ç¯„å›²:</label>
                        <div style="flex:1;display:flex;gap:10px;align-items:center">
                            <input type="time" id="dayScheduleStartTime" class="form-input" style="flex:1">
                            <span>ã€œ</span>
                            <input type="time" id="dayScheduleEndTime" class="form-input" style="flex:1">
                        </div>
                    </div>
                    <div style="display:flex;justify-content:flex-end">
                        <button class="action-btn primary" onclick="addDaySchedule()">è¿½åŠ </button>
                    </div>
                </div>
            </div>
            
            <!-- â­ å‰Šé™¤ã§ããªã„äºˆå®šã®ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="form-section">
                <label class="form-label" style="color:#d32f2f">âš ï¸ å‰Šé™¤ã§ããªã„äºˆå®šã®ç®¡ç†:</label>
                <p style="font-size:13px;color:#666;margin:10px 0">é€šå¸¸ã®æ–¹æ³•ã§å‰Šé™¤ã§ããªã„äºˆå®šã‚’æ¤œç´¢ã—ã¦å‰Šé™¤ã§ãã¾ã™</p>
                
                <div style="display:flex;flex-direction:column;gap:12px;margin-top:15px">
                    <!-- æ¤œç´¢æ¡ä»¶ -->
                    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
                        <select id="troubleDeleteStaff" class="form-select" style="min-width:100px">
                            <option value="">ã‚¹ã‚¿ãƒƒãƒ•</option>
                            <option value="Ka">Ka</option>
                            <option value="I">I</option>
                            <option value="Kik">Kik</option>
                            <option value="J">J</option>
                            <option value="Sim">Sim</option>
                            <option value="Yo">Yo</option>
                            <option value="Sai">Sai</option>
                            <option value="Ta">Ta</option>
                        </select>
                        <input type="date" id="troubleDeleteDate" class="form-input" style="min-width:150px">
                        <input type="text" id="troubleDeleteName" class="form-input" placeholder="åå‰ï¼ˆä»»æ„ï¼‰" style="min-width:120px">
                        <button class="action-btn primary" onclick="searchTroubleEvents()" style="white-space:nowrap">æ¤œç´¢</button>
                    </div>
                    
                    <!-- æ¤œç´¢çµæœ -->
                    <div id="troubleEventResults" style="display:none">
                        <div style="background:#f5f5f5;border-radius:8px;padding:15px;max-height:300px;overflow-y:auto">
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                                <strong id="troubleResultCount" style="font-size:14px">æ¤œç´¢çµæœ: 0ä»¶</strong>
                                <button class="action-btn danger" onclick="deleteAllTroubleEvents()" id="deleteAllBtn" style="display:none">ã™ã¹ã¦å‰Šé™¤</button>
                            </div>
                            <div id="troubleEventList"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <label class="form-label">ç¥æ—¥ç®¡ç†:</label>
                <div id="holidayList" class="list"></div>
            </div>
            
            <div class="form-section">
                <label class="form-label">ç¥æ—¥ã‚’ä¸€æ‹¬å–å¾—:</label>
                <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px">
                    <select id="holidayYear" class="form-select" style="flex:1">
                        <option value="">å¹´ã‚’é¸æŠ</option>
                    </select>
                    <button class="action-btn primary" onclick="fetchHolidaysFromInternet()">ğŸ“¥ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰å–å¾—</button>
                </div>
                <p style="font-size:12px;color:#666;margin:0">â€»å†…é–£åºœã®ç¥æ—¥ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•å–å¾—ã—ã¾ã™</p>
            </div>
            
            <div class="form-section">
                <label class="form-label">æ–°ã—ã„ç¥æ—¥ã‚’æ‰‹å‹•è¿½åŠ :</label>
                <div style="display:flex;gap:10px">
                    <input type="date" id="newHolidayDate" class="form-input" style="flex:1">
                    <button class="action-btn primary" onclick="addHoliday()">è¿½åŠ </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEvent()">&times;</span>
            <h2 class="modal-header" id="modalHeader">äºˆç´„è¿½åŠ </h2>
            <div class="selected-time" id="selectedTimeDisplay"></div>
            <div class="form-section" id="surnameSection">
                <label class="form-label">å§“:</label>
                <input type="text" id="surnameInput" class="form-input" placeholder="å§“ã‚’å…¥åŠ›(å¿…é ˆ)" required lang="ja" inputmode="text" autocomplete="off">
            </div>
            <div class="form-section" id="firstnameSection">
                <label class="form-label">å:</label>
                <input type="text" id="firstnameInput" class="form-input" placeholder="åã‚’å…¥åŠ›(ä»»æ„)" lang="ja" inputmode="text" autocomplete="off">
            </div>
            <div class="form-section" id="timeRangeSection" style="display:none">
                <label class="form-label">æ™‚é–“ç¯„å›²:</label>
                <div class="time-range-selects">
                    <div>
                        <label class="form-label" style="font-size:13px;margin-bottom:5px">é–‹å§‹æ™‚åˆ»:</label>
                        <select id="startTimeSelect" class="form-select"></select>
                    </div>
                    <div>
                        <label class="form-label" style="font-size:13px;margin-bottom:5px">çµ‚äº†æ™‚åˆ»:</label>
                        <select id="endTimeSelect" class="form-select"></select>
                    </div>
                </div>
            </div>
            <div class="form-section">
                <label class="form-label">äºˆå®šç¨®é¡:</label>
                <div class="type-grid">
                    <div class="type-option type-20min" data-type="20min">20åˆ†</div>
                    <div class="type-option type-40min" data-type="40min">40åˆ†</div>
                    <div class="type-option type-60min" data-type="60min">60åˆ†</div>
                    <div class="type-option type-visit" data-type="visit">è¨ªå•</div>
                    <div class="type-option type-workinjury20" data-type="workinjury20">åŠ´ç½20åˆ†</div>
                    <div class="type-option type-workinjury40" data-type="workinjury40">åŠ´ç½40åˆ†</div>
                    <div class="type-option type-accident" data-type="accident">äº‹æ•…</div>
                    <div class="type-option type-day" data-type="day">ãƒ‡ã‚¤</div>
                    <div class="type-option type-meeting" data-type="meeting">æ‹…ä¼š</div>
                    <div class="type-option type-other" data-type="other">ãã®ä»–</div>
                </div>
            </div>
            <div class="form-section" id="repeatSection">
                <label class="form-label">ç¹°ã‚Šè¿”ã—:</label>
                <select id="repeatSelect" class="form-select">
                    <option value="none">ãªã—</option>
                    <option value="weekly">æ¯é€±</option>
                    <option value="biweekly1">éš”é€±(1é€±é–“ãŠã)</option>
                    <option value="biweekly2">éš”é€±(2é€±é–“ãŠã)</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="action-btn danger" id="deleteButton" onclick="deleteEvent()" style="display:none">å‰Šé™¤</button>
                <button class="action-btn danger" id="deleteSingleButton" onclick="deleteSingle()" style="display:none">ã“ã®äºˆå®šã®ã¿å‰Šé™¤</button>
                <button class="action-btn danger" id="deleteFromButton" onclick="deleteFrom()" style="display:none">ã“ã®æ—¥ä»¥é™ã‚’å‰Šé™¤</button>
                <button class="action-btn secondary" onclick="closeEvent()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="action-btn primary" onclick="saveEvent()">ä¿å­˜</button>
            </div>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // FirebaseåˆæœŸåŒ–ã‚’ä¸€åº¦ã ã‘å®Ÿè¡Œ
        if (!window.firebaseInitialized) {
            window.firebaseInitialized = true;
            
            firebase.initializeApp({
                apiKey: "AIzaSyCFj54m36M6Ai-3qPqCOUv-hzjtQf34YsU",
                authDomain: "schedule-manager-87b03.firebaseapp.com",
                projectId: "schedule-manager-87b03",
                storageBucket: "schedule-manager-87b03.firebasestorage.app",
                messagingSenderId: "280835955919",
                appId: "1:280835955919:web:69a1ec7c9e5c20cdc2ebba"
            });
            
            window.db = firebase.firestore();
            
            window.db.enablePersistence({
                synchronizeTabs: false
            }).catch((err) => {
                if (err.code == 'failed-precondition') {
                    console.log('Multiple tabs open, persistence can only be enabled in one tab at a time.');
                } else if (err.code == 'unimplemented') {
                    console.log('The current browser does not support persistence.');
                }
            });
        }
        
        var db = window.db;
        var isCapacitorApp = false;
        var CapacitorApp, StatusBar, SplashScreen, Network, Keyboard, Haptics, Toast, Dialog;
        var app;
    </script>
    
    <script src="app-core.js"></script>
    <script src="read-counter.js"></script>
    <script src="app-events.js"></script>
    <script src="conflict-check.js"></script>
    <script src="app-ui.js"></script>
    <script src="app-export.js"></script>
    <script src="app-main.js"></script>
    <script src="app-init.js"></script>
    <script src="trouble-delete.js"></script>
    <script src="bulk-reservation.js"></script>
    <script src="bulk-delete.js"></script>
    <script src="search.js"></script>
    <script src="holiday-fetch.js"></script>
    
   <!-- ã‚¹ã‚¿ãƒƒãƒ•ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹å‹•çš„æ›´æ–°ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<script>
    window.addEventListener('load', function() {
        setTimeout(() => {
            const originalOpenManagement = window.openManagement;
            window.openManagement = function() {
                if (originalOpenManagement) originalOpenManagement();
                updateStaffSelects();
            };
            
            function updateStaffSelects() {
                setTimeout(() => {
                    if (window.app && window.app.teamMembers) {
                        // ã‚¹ã‚¿ãƒƒãƒ•å…¥ã‚Œæ›¿ãˆç”¨
                        const select1 = document.getElementById('overrideOriginalStaff');
                        const select2 = document.getElementById('overrideReplacementStaff');
                        
                        // æœ‰çµ¦ãƒ»å…¬ä¼‘æ—¥ç”¨
                        const leaveSelect = document.getElementById('leaveStaffSelect');
                        
                        if (select1 && select2) {
                            const current1 = select1.value;
                            const current2 = select2.value;
                            
                            select1.innerHTML = '<option value="">ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠ</option>';
                            select2.innerHTML = '<option value="">ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠ</option>';
                            
                            window.app.teamMembers.forEach(m => {
                                const name = `${m.surname || ''}${m.firstname || ''}`;
                                
                                const option1 = document.createElement('option');
                                option1.value = name;
                                option1.textContent = name;
                                select1.appendChild(option1);
                                
                                const option2 = document.createElement('option');
                                option2.value = name;
                                option2.textContent = name;
                                select2.appendChild(option2);
                            });
                            
                            select1.value = current1;
                            select2.value = current2;
                        }
                        
                        if (leaveSelect) {
                            const currentLeave = leaveSelect.value;
                            
                            leaveSelect.innerHTML = '<option value="">ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠ</option>';
                            
                            window.app.teamMembers.forEach(m => {
                                const name = `${m.surname || ''}${m.firstname || ''}`;
                                const option = document.createElement('option');
                                option.value = name;
                                option.textContent = name;
                                leaveSelect.appendChild(option);
                            });
                            
                            leaveSelect.value = currentLeave;
                        }
                    }
                }, 100);
            }
        }, 2000);
    });
    
    // ãƒ‡ã‚¤ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³é¸æŠå‡¦ç†
    document.addEventListener('DOMContentLoaded', () => {
        const patternSelect = document.getElementById('daySchedulePattern');
        const customTimeSection = document.getElementById('customTimeSection');
        
        if (patternSelect) {
            patternSelect.addEventListener('change', () => {
                if (patternSelect.value === 'custom') {
                    customTimeSection.style.display = 'flex';
                } else {
                    customTimeSection.style.display = 'none';
                }
            });
        }
    });
</script>
</body>
</html>
